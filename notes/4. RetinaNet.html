<!DOCTYPE html>
<html>
  <head>
    <title>4. RetinaNet</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css"
    />

    <style>
      code[class*="language-"],
      pre[class*="language-"] {
        color: #333;
        background: 0 0;
        font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
        text-align: left;
        white-space: pre;
        word-spacing: normal;
        word-break: normal;
        word-wrap: normal;
        line-height: 1.4;
        -moz-tab-size: 8;
        -o-tab-size: 8;
        tab-size: 8;
        -webkit-hyphens: none;
        -moz-hyphens: none;
        -ms-hyphens: none;
        hyphens: none;
      }
      pre[class*="language-"] {
        padding: 0.8em;
        overflow: auto;
        border-radius: 3px;
        background: #f5f5f5;
      }
      :not(pre) > code[class*="language-"] {
        padding: 0.1em;
        border-radius: 0.3em;
        white-space: normal;
        background: #f5f5f5;
      }
      .token.blockquote,
      .token.comment {
        color: #969896;
      }
      .token.cdata {
        color: #183691;
      }
      .token.doctype,
      .token.macro.property,
      .token.punctuation,
      .token.variable {
        color: #333;
      }
      .token.builtin,
      .token.important,
      .token.keyword,
      .token.operator,
      .token.rule {
        color: #a71d5d;
      }
      .token.attr-value,
      .token.regex,
      .token.string,
      .token.url {
        color: #183691;
      }
      .token.atrule,
      .token.boolean,
      .token.code,
      .token.command,
      .token.constant,
      .token.entity,
      .token.number,
      .token.property,
      .token.symbol {
        color: #0086b3;
      }
      .token.prolog,
      .token.selector,
      .token.tag {
        color: #63a35c;
      }
      .token.attr-name,
      .token.class,
      .token.class-name,
      .token.function,
      .token.id,
      .token.namespace,
      .token.pseudo-class,
      .token.pseudo-element,
      .token.url-reference .token.variable {
        color: #795da3;
      }
      .token.entity {
        cursor: help;
      }
      .token.title,
      .token.title .token.punctuation {
        font-weight: 700;
        color: #1d3e81;
      }
      .token.list {
        color: #ed6a43;
      }
      .token.inserted {
        background-color: #eaffea;
        color: #55a532;
      }
      .token.deleted {
        background-color: #ffecec;
        color: #bd2c00;
      }
      .token.bold {
        font-weight: 700;
      }
      .token.italic {
        font-style: italic;
      }
      .language-json .token.property {
        color: #183691;
      }
      .language-markup .token.tag .token.punctuation {
        color: #333;
      }
      .language-css .token.function,
      code.language-css {
        color: #0086b3;
      }
      .language-yaml .token.atrule {
        color: #63a35c;
      }
      code.language-yaml {
        color: #183691;
      }
      .language-ruby .token.function {
        color: #333;
      }
      .language-markdown .token.url {
        color: #795da3;
      }
      .language-makefile .token.symbol {
        color: #795da3;
      }
      .language-makefile .token.variable {
        color: #183691;
      }
      .language-makefile .token.builtin {
        color: #0086b3;
      }
      .language-bash .token.keyword {
        color: #0086b3;
      }
      pre[data-line] {
        position: relative;
        padding: 1em 0 1em 3em;
      }
      pre[data-line] .line-highlight-wrapper {
        position: absolute;
        top: 0;
        left: 0;
        background-color: transparent;
        display: block;
        width: 100%;
      }
      pre[data-line] .line-highlight {
        position: absolute;
        left: 0;
        right: 0;
        padding: inherit 0;
        margin-top: 1em;
        background: hsla(24, 20%, 50%, 0.08);
        background: linear-gradient(
          to right,
          hsla(24, 20%, 50%, 0.1) 70%,
          hsla(24, 20%, 50%, 0)
        );
        pointer-events: none;
        line-height: inherit;
        white-space: pre;
      }
      pre[data-line] .line-highlight:before,
      pre[data-line] .line-highlight[data-end]:after {
        content: attr(data-start);
        position: absolute;
        top: 0.4em;
        left: 0.6em;
        min-width: 1em;
        padding: 0 0.5em;
        background-color: hsla(24, 20%, 50%, 0.4);
        color: #f4f1ef;
        font: bold 65%/1.5 sans-serif;
        text-align: center;
        vertical-align: 0.3em;
        border-radius: 999px;
        text-shadow: none;
        box-shadow: 0 1px #fff;
      }
      pre[data-line] .line-highlight[data-end]:after {
        content: attr(data-end);
        top: auto;
        bottom: 0.4em;
      }
      html body {
        font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans,
          sans-serif;
        font-size: 16px;
        line-height: 1.6;
        color: #333;
        background-color: #fff;
        overflow: initial;
        box-sizing: border-box;
        word-wrap: break-word;
      }
      html body > :first-child {
        margin-top: 0;
      }
      html body h1,
      html body h2,
      html body h3,
      html body h4,
      html body h5,
      html body h6 {
        line-height: 1.2;
        margin-top: 1em;
        margin-bottom: 16px;
        color: #000;
      }
      html body h1 {
        font-size: 2.25em;
        font-weight: 300;
        padding-bottom: 0.3em;
      }
      html body h2 {
        font-size: 1.75em;
        font-weight: 400;
        padding-bottom: 0.3em;
      }
      html body h3 {
        font-size: 1.5em;
        font-weight: 500;
      }
      html body h4 {
        font-size: 1.25em;
        font-weight: 600;
      }
      html body h5 {
        font-size: 1.1em;
        font-weight: 600;
      }
      html body h6 {
        font-size: 1em;
        font-weight: 600;
      }
      html body h1,
      html body h2,
      html body h3,
      html body h4,
      html body h5 {
        font-weight: 600;
      }
      html body h5 {
        font-size: 1em;
      }
      html body h6 {
        color: #5c5c5c;
      }
      html body strong {
        color: #000;
      }
      html body del {
        color: #5c5c5c;
      }
      html body a:not([href]) {
        color: inherit;
        text-decoration: none;
      }
      html body a {
        color: #08c;
        text-decoration: none;
      }
      html body a:hover {
        color: #00a3f5;
        text-decoration: none;
      }
      html body img {
        max-width: 100%;
      }
      html body > p {
        margin-top: 0;
        margin-bottom: 16px;
        word-wrap: break-word;
      }
      html body > ol,
      html body > ul {
        margin-bottom: 16px;
      }
      html body ol,
      html body ul {
        padding-left: 2em;
      }
      html body ol.no-list,
      html body ul.no-list {
        padding: 0;
        list-style-type: none;
      }
      html body ol ol,
      html body ol ul,
      html body ul ol,
      html body ul ul {
        margin-top: 0;
        margin-bottom: 0;
      }
      html body li {
        margin-bottom: 0;
      }
      html body li.task-list-item {
        list-style: none;
      }
      html body li > p {
        margin-top: 0;
        margin-bottom: 0;
      }
      html body .task-list-item-checkbox {
        margin: 0 0.2em 0.25em -1.8em;
        vertical-align: middle;
      }
      html body .task-list-item-checkbox:hover {
        cursor: pointer;
      }
      html body blockquote {
        margin: 16px 0;
        font-size: inherit;
        padding: 0 15px;
        color: #5c5c5c;
        background-color: #f0f0f0;
        border-left: 4px solid #d6d6d6;
      }
      html body blockquote > :first-child {
        margin-top: 0;
      }
      html body blockquote > :last-child {
        margin-bottom: 0;
      }
      html body hr {
        height: 4px;
        margin: 32px 0;
        background-color: #d6d6d6;
        border: 0 none;
      }
      html body table {
        margin: 10px 0 15px 0;
        border-collapse: collapse;
        border-spacing: 0;
        display: block;
        width: 100%;
        overflow: auto;
        word-break: normal;
        word-break: keep-all;
      }
      html body table th {
        font-weight: 700;
        color: #000;
      }
      html body table td,
      html body table th {
        border: 1px solid #d6d6d6;
        padding: 6px 13px;
      }
      html body dl {
        padding: 0;
      }
      html body dl dt {
        padding: 0;
        margin-top: 16px;
        font-size: 1em;
        font-style: italic;
        font-weight: 700;
      }
      html body dl dd {
        padding: 0 16px;
        margin-bottom: 16px;
      }
      html body code {
        font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
        font-size: 0.85em;
        color: #000;
        background-color: #f0f0f0;
        border-radius: 3px;
        padding: 0.2em 0;
      }
      html body code::after,
      html body code::before {
        letter-spacing: -0.2em;
        content: "\00a0";
      }
      html body pre > code {
        padding: 0;
        margin: 0;
        word-break: normal;
        white-space: pre;
        background: 0 0;
        border: 0;
      }
      html body .highlight {
        margin-bottom: 16px;
      }
      html body .highlight pre,
      html body pre {
        padding: 1em;
        overflow: auto;
        line-height: 1.45;
        border: #d6d6d6;
        border-radius: 3px;
      }
      html body .highlight pre {
        margin-bottom: 0;
        word-break: normal;
      }
      html body pre code,
      html body pre tt {
        display: inline;
        max-width: initial;
        padding: 0;
        margin: 0;
        overflow: initial;
        line-height: inherit;
        word-wrap: normal;
        background-color: transparent;
        border: 0;
      }
      html body pre code:after,
      html body pre code:before,
      html body pre tt:after,
      html body pre tt:before {
        content: normal;
      }
      html body blockquote,
      html body dl,
      html body ol,
      html body p,
      html body pre,
      html body ul {
        margin-top: 0;
        margin-bottom: 16px;
      }
      html body kbd {
        color: #000;
        border: 1px solid #d6d6d6;
        border-bottom: 2px solid #c7c7c7;
        padding: 2px 4px;
        background-color: #f0f0f0;
        border-radius: 3px;
      }
      @media print {
        html body {
          background-color: #fff;
        }
        html body h1,
        html body h2,
        html body h3,
        html body h4,
        html body h5,
        html body h6 {
          color: #000;
          page-break-after: avoid;
        }
        html body blockquote {
          color: #5c5c5c;
        }
        html body pre {
          page-break-inside: avoid;
        }
        html body table {
          display: table;
        }
        html body img {
          display: block;
          max-width: 100%;
          max-height: 100%;
        }
        html body code,
        html body pre {
          word-wrap: break-word;
          white-space: pre;
        }
      }
      .markdown-preview {
        width: 100%;
        height: 100%;
        box-sizing: border-box;
      }
      .markdown-preview ul {
        list-style: disc;
      }
      .markdown-preview ul ul {
        list-style: circle;
      }
      .markdown-preview ul ul ul {
        list-style: square;
      }
      .markdown-preview ol {
        list-style: decimal;
      }
      .markdown-preview ol ol,
      .markdown-preview ul ol {
        list-style-type: lower-roman;
      }
      .markdown-preview ol ol ol,
      .markdown-preview ol ul ol,
      .markdown-preview ul ol ol,
      .markdown-preview ul ul ol {
        list-style-type: lower-alpha;
      }
      .markdown-preview .newpage,
      .markdown-preview .pagebreak {
        page-break-before: always;
      }
      .markdown-preview pre.line-numbers {
        position: relative;
        padding-left: 3.8em;
        counter-reset: linenumber;
      }
      .markdown-preview pre.line-numbers > code {
        position: relative;
      }
      .markdown-preview pre.line-numbers .line-numbers-rows {
        position: absolute;
        pointer-events: none;
        top: 1em;
        font-size: 100%;
        left: 0;
        width: 3em;
        letter-spacing: -1px;
        border-right: 1px solid #999;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      .markdown-preview pre.line-numbers .line-numbers-rows > span {
        pointer-events: none;
        display: block;
        counter-increment: linenumber;
      }
      .markdown-preview pre.line-numbers .line-numbers-rows > span:before {
        content: counter(linenumber);
        color: #999;
        display: block;
        padding-right: 0.8em;
        text-align: right;
      }
      .markdown-preview .mathjax-exps .MathJax_Display {
        text-align: center !important;
      }
      .markdown-preview:not([data-for="preview"])
        .code-chunk
        .code-chunk-btn-group {
        display: none;
      }
      .markdown-preview:not([data-for="preview"]) .code-chunk .status {
        display: none;
      }
      .markdown-preview:not([data-for="preview"]) .code-chunk .output-div {
        margin-bottom: 16px;
      }
      .markdown-preview .md-toc {
        padding: 0;
      }
      .markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link {
        display: inline;
        padding: 0.25rem 0;
      }
      .markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,
      .markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p {
        display: inline;
      }
      .markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link {
        font-weight: 800;
      }
      .scrollbar-style::-webkit-scrollbar {
        width: 8px;
      }
      .scrollbar-style::-webkit-scrollbar-track {
        border-radius: 10px;
        background-color: transparent;
      }
      .scrollbar-style::-webkit-scrollbar-thumb {
        border-radius: 5px;
        background-color: rgba(150, 150, 150, 0.66);
        border: 4px solid rgba(150, 150, 150, 0.66);
        background-clip: content-box;
      }
      html body[for="html-export"]:not([data-presentation-mode]) {
        position: relative;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        margin: 0;
        padding: 0;
        overflow: auto;
      }
      html
        body[for="html-export"]:not([data-presentation-mode])
        .markdown-preview {
        position: relative;
        top: 0;
        min-height: 100vh;
      }
      @media screen and (min-width: 914px) {
        html
          body[for="html-export"]:not([data-presentation-mode])
          .markdown-preview {
          padding: 2em calc(50% - 457px + 2em);
        }
      }
      @media screen and (max-width: 914px) {
        html
          body[for="html-export"]:not([data-presentation-mode])
          .markdown-preview {
          padding: 2em;
        }
      }
      @media screen and (max-width: 450px) {
        html
          body[for="html-export"]:not([data-presentation-mode])
          .markdown-preview {
          font-size: 14px !important;
          padding: 1em;
        }
      }
      @media print {
        html
          body[for="html-export"]:not([data-presentation-mode])
          #sidebar-toc-btn {
          display: none;
        }
      }
      html
        body[for="html-export"]:not([data-presentation-mode])
        #sidebar-toc-btn {
        position: fixed;
        bottom: 8px;
        left: 8px;
        font-size: 28px;
        cursor: pointer;
        color: inherit;
        z-index: 99;
        width: 32px;
        text-align: center;
        opacity: 0.4;
      }
      html
        body[for="html-export"]:not(
          [data-presentation-mode]
        )[html-show-sidebar-toc]
        #sidebar-toc-btn {
        opacity: 1;
      }
      html
        body[for="html-export"]:not(
          [data-presentation-mode]
        )[html-show-sidebar-toc]
        .md-sidebar-toc {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        padding: 32px 0 48px 0;
        font-size: 14px;
        box-shadow: 0 0 4px rgba(150, 150, 150, 0.33);
        box-sizing: border-box;
        overflow: auto;
        background-color: inherit;
      }
      html
        body[for="html-export"]:not(
          [data-presentation-mode]
        )[html-show-sidebar-toc]
        .md-sidebar-toc::-webkit-scrollbar {
        width: 8px;
      }
      html
        body[for="html-export"]:not(
          [data-presentation-mode]
        )[html-show-sidebar-toc]
        .md-sidebar-toc::-webkit-scrollbar-track {
        border-radius: 10px;
        background-color: transparent;
      }
      html
        body[for="html-export"]:not(
          [data-presentation-mode]
        )[html-show-sidebar-toc]
        .md-sidebar-toc::-webkit-scrollbar-thumb {
        border-radius: 5px;
        background-color: rgba(150, 150, 150, 0.66);
        border: 4px solid rgba(150, 150, 150, 0.66);
        background-clip: content-box;
      }
      html
        body[for="html-export"]:not(
          [data-presentation-mode]
        )[html-show-sidebar-toc]
        .md-sidebar-toc
        a {
        text-decoration: none;
      }
      html
        body[for="html-export"]:not(
          [data-presentation-mode]
        )[html-show-sidebar-toc]
        .md-sidebar-toc
        .md-toc {
        padding: 0 16px;
      }
      html
        body[for="html-export"]:not(
          [data-presentation-mode]
        )[html-show-sidebar-toc]
        .md-sidebar-toc
        .md-toc
        .md-toc-link-wrapper
        .md-toc-link {
        display: inline;
        padding: 0.25rem 0;
      }
      html
        body[for="html-export"]:not(
          [data-presentation-mode]
        )[html-show-sidebar-toc]
        .md-sidebar-toc
        .md-toc
        .md-toc-link-wrapper
        .md-toc-link
        div,
      html
        body[for="html-export"]:not(
          [data-presentation-mode]
        )[html-show-sidebar-toc]
        .md-sidebar-toc
        .md-toc
        .md-toc-link-wrapper
        .md-toc-link
        p {
        display: inline;
      }
      html
        body[for="html-export"]:not(
          [data-presentation-mode]
        )[html-show-sidebar-toc]
        .md-sidebar-toc
        .md-toc
        .md-toc-link-wrapper.highlighted
        .md-toc-link {
        font-weight: 800;
      }
      html
        body[for="html-export"]:not(
          [data-presentation-mode]
        )[html-show-sidebar-toc]
        .markdown-preview {
        left: 300px;
        width: calc(100% - 300px);
        padding: 2em calc(50% - 457px - 300px / 2);
        margin: 0;
        box-sizing: border-box;
      }
      @media screen and (max-width: 1274px) {
        html
          body[for="html-export"]:not(
            [data-presentation-mode]
          )[html-show-sidebar-toc]
          .markdown-preview {
          padding: 2em;
        }
      }
      @media screen and (max-width: 450px) {
        html
          body[for="html-export"]:not(
            [data-presentation-mode]
          )[html-show-sidebar-toc]
          .markdown-preview {
          width: 100%;
        }
      }
      html
        body[for="html-export"]:not([data-presentation-mode]):not(
          [html-show-sidebar-toc]
        )
        .markdown-preview {
        left: 50%;
        transform: translateX(-50%);
      }
      html
        body[for="html-export"]:not([data-presentation-mode]):not(
          [html-show-sidebar-toc]
        )
        .md-sidebar-toc {
        display: none;
      }
      /* Please visit the URL below for more information: */
      /*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      html body {
        background-image: url("https://github.com/mingqian-233/CV-Notes/blob/master/images/bg_4.jpeg?raw=true");
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-position: center;
        position: relative;
      }
      html body::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: inherit;
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-position: center;
        filter: blur(1px); /* 设置模糊效果 */
        z-index: -2;
      }
      html body::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.6); /* 白色蒙版 */
        z-index: -1;
      }
    </style>
    <!-- The content below will be included at the end of the <head> element. -->
    <script type="text/javascript">
      document.addEventListener("DOMContentLoaded", function () {
        // your code here
      });
    </script>
  </head>
  <body for="html-export">
    <div class="crossnote markdown-preview">
      <h1 id="focal-loss-for-dense-object-detectionretinanet阅读笔记">
        《Focal Loss for Dense Object Detection》（RetinaNet）阅读笔记
      </h1>
      <h2 id="简介">简介</h2>
      <p>
        RetinaNet 通过改进 Loss
        函数，解决了单阶段方法在前景和背景的极端不平衡问题，消除了单阶段方法在目标检测中的精度劣势，甚至能够超越现有的双阶段方法。
      </p>
      <h2 id="背景">背景</h2>
      <p>
        R-CNN 这种两阶段方法在目标检测中一直拥有比单阶段方法更高的
        accuracy，通常用于稀疏目标检测。而对于密集的目标，一般使用单阶段方法，它们更快更简单（成本更低）。但是单阶段方法的
        accuracy 仍然是个问题。
      </p>
      <blockquote>
        <p>
          SSD 和 YOLO 就是经典的单阶段检测器。它们牺牲了精度换取效率。<br />
          类别失衡：单阶段检测方法广泛的问题。训练阶段，SSD
          等检测器对每个图像都评估<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow
                    ><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow
                  ><annotation encoding="application/x-tex"
                    >10^4</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.8141em"></span
                ><span class="mord">1</span
                ><span class="mord"
                  ><span class="mord">0</span
                  ><span class="msupsub"
                    ><span class="vlist-t"
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.8141em"
                          ><span style="top: -3.063em; margin-right: 0.05em"
                            ><span class="pstrut" style="height: 2.7em"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mtight">4</span></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          >~<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow
                    ><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow
                  ><annotation encoding="application/x-tex"
                    >10^5</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.8141em"></span
                ><span class="mord">1</span
                ><span class="mord"
                  ><span class="mord">0</span
                  ><span class="msupsub"
                    ><span class="vlist-t"
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.8141em"
                          ><span style="top: -3.063em; margin-right: 0.05em"
                            ><span class="pstrut" style="height: 2.7em"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mtight">5</span></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          >个位置，然而这些位置有大量的背景，仅有少部分包含目标，而且目标里面又有
          hard
          samples（难以检测的样本）。因此，大量重复的简单的负面样本浪费了训练资源，并且在训练中占有过分的主导地位。常见的解决方案是
          hard negative mining 去采样 hard samples。
        </p>
      </blockquote>
      <h2 id="实现">实现</h2>
      <p>
        作者发现精度低下的根本原因是类别失衡。所以作者将交叉熵误差函数改进为
        Focal Loss。
      </p>
      <p>经典的 CE loss 公式为：</p>
      <p>
        <span class="katex-display"
          ><span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"
                ><semantics
                  ><mrow
                    ><mtext>CE</mtext><mo stretchy="false">(</mo><mi>p</mi
                    ><mo separator="true">,</mo><mi>y</mi
                    ><mo stretchy="false">)</mo><mo>=</mo
                    ><mrow
                      ><mo fence="true">{</mo
                      ><mtable
                        rowspacing="0.36em"
                        columnalign="left left"
                        columnspacing="1em"
                        ><mtr
                          ><mtd
                            ><mstyle scriptlevel="0" displaystyle="false"
                              ><mrow
                                ><mo>−</mo><mi>log</mi><mo>⁡</mo
                                ><mo stretchy="false">(</mo><mi>p</mi
                                ><mo stretchy="false">)</mo></mrow
                              ></mstyle
                            ></mtd
                          ><mtd
                            ><mstyle scriptlevel="0" displaystyle="false"
                              ><mrow
                                ><mtext>if&nbsp;</mtext><mi>y</mi><mo>=</mo
                                ><mn>1</mn></mrow
                              ></mstyle
                            ></mtd
                          ></mtr
                        ><mtr
                          ><mtd
                            ><mstyle scriptlevel="0" displaystyle="false"
                              ><mrow
                                ><mo>−</mo><mi>log</mi><mo>⁡</mo
                                ><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo
                                ><mi>p</mi><mo stretchy="false">)</mo></mrow
                              ></mstyle
                            ></mtd
                          ><mtd
                            ><mstyle scriptlevel="0" displaystyle="false"
                              ><mrow
                                ><mtext>if&nbsp;</mtext><mi>y</mi><mo>=</mo
                                ><mn>0</mn></mrow
                              ></mstyle
                            ></mtd
                          ></mtr
                        ></mtable
                      ></mrow
                    ></mrow
                  ><annotation encoding="application/x-tex"
                    >\text{CE}(p, y) = \begin{cases} -\log(p) &amp; \text{if } y
                    = 1 \\ -\log(1 - p) &amp; \text{if } y = 0
                    \end{cases}</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="mord text"><span class="mord">CE</span></span
                ><span class="mopen">(</span
                ><span class="mord mathnormal">p</span
                ><span class="mpunct">,</span
                ><span class="mspace" style="margin-right: 0.1667em"></span
                ><span class="mord mathnormal" style="margin-right: 0.03588em"
                  >y</span
                ><span class="mclose">)</span
                ><span class="mspace" style="margin-right: 0.2778em"></span
                ><span class="mrel">=</span
                ><span
                  class="mspace"
                  style="margin-right: 0.2778em"
                ></span></span
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 3em; vertical-align: -1.25em"
                ></span
                ><span class="minner"
                  ><span class="mopen delimcenter" style="top: 0em"
                    ><span class="delimsizing size4">{</span></span
                  ><span class="mord"
                    ><span class="mtable"
                      ><span class="col-align-l"
                        ><span class="vlist-t vlist-t2"
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 1.69em"
                              ><span style="top: -3.69em"
                                ><span
                                  class="pstrut"
                                  style="height: 3.008em"
                                ></span
                                ><span class="mord"
                                  ><span class="mord">−</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.1667em"
                                  ></span
                                  ><span class="mop"
                                    >lo<span style="margin-right: 0.01389em"
                                      >g</span
                                    ></span
                                  ><span class="mopen">(</span
                                  ><span class="mord mathnormal">p</span
                                  ><span class="mclose">)</span></span
                                ></span
                              ><span style="top: -2.25em"
                                ><span
                                  class="pstrut"
                                  style="height: 3.008em"
                                ></span
                                ><span class="mord"
                                  ><span class="mord">−</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.1667em"
                                  ></span
                                  ><span class="mop"
                                    >lo<span style="margin-right: 0.01389em"
                                      >g</span
                                    ></span
                                  ><span class="mopen">(</span
                                  ><span class="mord">1</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.2222em"
                                  ></span
                                  ><span class="mbin">−</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.2222em"
                                  ></span
                                  ><span class="mord mathnormal">p</span
                                  ><span class="mclose">)</span></span
                                ></span
                              ></span
                            ><span class="vlist-s">​</span></span
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 1.19em"
                              ><span></span></span></span></span></span
                      ><span class="arraycolsep" style="width: 1em"></span
                      ><span class="col-align-l"
                        ><span class="vlist-t vlist-t2"
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 1.69em"
                              ><span style="top: -3.69em"
                                ><span
                                  class="pstrut"
                                  style="height: 3.008em"
                                ></span
                                ><span class="mord"
                                  ><span class="mord text"
                                    ><span class="mord">if&nbsp;</span></span
                                  ><span
                                    class="mord mathnormal"
                                    style="margin-right: 0.03588em"
                                    >y</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.2778em"
                                  ></span
                                  ><span class="mrel">=</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.2778em"
                                  ></span
                                  ><span class="mord">1</span></span
                                ></span
                              ><span style="top: -2.25em"
                                ><span
                                  class="pstrut"
                                  style="height: 3.008em"
                                ></span
                                ><span class="mord"
                                  ><span class="mord text"
                                    ><span class="mord">if&nbsp;</span></span
                                  ><span
                                    class="mord mathnormal"
                                    style="margin-right: 0.03588em"
                                    >y</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.2778em"
                                  ></span
                                  ><span class="mrel">=</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.2778em"
                                  ></span
                                  ><span class="mord">0</span></span
                                ></span
                              ></span
                            ><span class="vlist-s">​</span></span
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 1.19em"
                              ><span></span></span></span></span></span></span></span
                  ><span
                    class="mclose nulldelimiter"
                  ></span></span></span></span></span
        ></span>
      </p>
      <p>其中：</p>
      <ul>
        <li>
          <span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>y</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >y</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.625em; vertical-align: -0.1944em"
                ></span
                ><span class="mord mathnormal" style="margin-right: 0.03588em"
                  >y</span
                ></span
              ></span
            ></span
          >
          是真实标签（<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow
                  ><annotation encoding="application/x-tex"
                    >y = 1</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.625em; vertical-align: -0.1944em"
                ></span
                ><span class="mord mathnormal" style="margin-right: 0.03588em"
                  >y</span
                ><span class="mspace" style="margin-right: 0.2778em"></span
                ><span class="mrel">=</span
                ><span
                  class="mspace"
                  style="margin-right: 0.2778em"
                ></span></span
              ><span class="base"
                ><span class="strut" style="height: 0.6444em"></span
                ><span class="mord">1</span></span
              ></span
            ></span
          >
          表示正类，<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow
                  ><annotation encoding="application/x-tex"
                    >y = 0</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.625em; vertical-align: -0.1944em"
                ></span
                ><span class="mord mathnormal" style="margin-right: 0.03588em"
                  >y</span
                ><span class="mspace" style="margin-right: 0.2778em"></span
                ><span class="mrel">=</span
                ><span
                  class="mspace"
                  style="margin-right: 0.2778em"
                ></span></span
              ><span class="base"
                ><span class="strut" style="height: 0.6444em"></span
                ><span class="mord">0</span></span
              ></span
            ></span
          >
          表示负类）。
        </li>
        <li>
          <span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>p</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >p</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.625em; vertical-align: -0.1944em"
                ></span
                ><span class="mord mathnormal">p</span></span
              ></span
            ></span
          >
          是模型预测为正类的概率（<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow
                    ><mi>p</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn
                    ><mo separator="true">,</mo><mn>1</mn
                    ><mo stretchy="false">]</mo></mrow
                  ><annotation encoding="application/x-tex"
                    >p \in [0, 1]</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.7335em; vertical-align: -0.1944em"
                ></span
                ><span class="mord mathnormal">p</span
                ><span class="mspace" style="margin-right: 0.2778em"></span
                ><span class="mrel">∈</span
                ><span
                  class="mspace"
                  style="margin-right: 0.2778em"
                ></span></span
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="mopen">[</span><span class="mord">0</span
                ><span class="mpunct">,</span
                ><span class="mspace" style="margin-right: 0.1667em"></span
                ><span class="mord">1</span><span class="mclose">]</span></span
              ></span
            ></span
          >）。
        </li>
      </ul>
      <p>
        为了简化公式，可以引入
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><msub><mi>p</mi><mi>t</mi></msub></mrow
                ><annotation encoding="application/x-tex"
                  >p_t</annotation
                ></semantics
              ></math
            ></span
          ><span class="katex-html" aria-hidden="true"
            ><span class="base"
              ><span
                class="strut"
                style="height: 0.625em; vertical-align: -0.1944em"
              ></span
              ><span class="mord"
                ><span class="mord mathnormal">p</span
                ><span class="msupsub"
                  ><span class="vlist-t vlist-t2"
                    ><span class="vlist-r"
                      ><span class="vlist" style="height: 0.2806em"
                        ><span
                          style="
                            top: -2.55em;
                            margin-left: 0em;
                            margin-right: 0.05em;
                          "
                          ><span class="pstrut" style="height: 2.7em"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mathnormal mtight">t</span></span
                          ></span
                        ></span
                      ><span class="vlist-s">​</span></span
                    ><span class="vlist-r"
                      ><span class="vlist" style="height: 0.15em"
                        ><span></span></span></span></span></span></span></span></span
        ></span>
        表示模型对真实类别的预测概率：
      </p>
      <p>
        <span class="katex-display"
          ><span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"
                ><semantics
                  ><mrow
                    ><msub><mi>p</mi><mi>t</mi></msub
                    ><mo>=</mo
                    ><mrow
                      ><mo fence="true">{</mo
                      ><mtable
                        rowspacing="0.36em"
                        columnalign="left left"
                        columnspacing="1em"
                        ><mtr
                          ><mtd
                            ><mstyle scriptlevel="0" displaystyle="false"
                              ><mi>p</mi></mstyle
                            ></mtd
                          ><mtd
                            ><mstyle scriptlevel="0" displaystyle="false"
                              ><mrow
                                ><mtext>if&nbsp;</mtext><mi>y</mi><mo>=</mo
                                ><mn>1</mn></mrow
                              ></mstyle
                            ></mtd
                          ></mtr
                        ><mtr
                          ><mtd
                            ><mstyle scriptlevel="0" displaystyle="false"
                              ><mrow
                                ><mn>1</mn><mo>−</mo><mi>p</mi></mrow
                              ></mstyle
                            ></mtd
                          ><mtd
                            ><mstyle scriptlevel="0" displaystyle="false"
                              ><mrow
                                ><mtext>if&nbsp;</mtext><mi>y</mi><mo>=</mo
                                ><mn>0</mn></mrow
                              ></mstyle
                            ></mtd
                          ></mtr
                        ></mtable
                      ></mrow
                    ></mrow
                  ><annotation encoding="application/x-tex"
                    >p_t = \begin{cases} p &amp; \text{if } y = 1 \\ 1 - p &amp;
                    \text{if } y = 0 \end{cases}</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.625em; vertical-align: -0.1944em"
                ></span
                ><span class="mord"
                  ><span class="mord mathnormal">p</span
                  ><span class="msupsub"
                    ><span class="vlist-t vlist-t2"
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.2806em"
                          ><span
                            style="
                              top: -2.55em;
                              margin-left: 0em;
                              margin-right: 0.05em;
                            "
                            ><span class="pstrut" style="height: 2.7em"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mathnormal mtight"
                                >t</span
                              ></span
                            ></span
                          ></span
                        ><span class="vlist-s">​</span></span
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.15em"
                          ><span></span></span></span></span></span></span
                ><span class="mspace" style="margin-right: 0.2778em"></span
                ><span class="mrel">=</span
                ><span
                  class="mspace"
                  style="margin-right: 0.2778em"
                ></span></span
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 3em; vertical-align: -1.25em"
                ></span
                ><span class="minner"
                  ><span class="mopen delimcenter" style="top: 0em"
                    ><span class="delimsizing size4">{</span></span
                  ><span class="mord"
                    ><span class="mtable"
                      ><span class="col-align-l"
                        ><span class="vlist-t vlist-t2"
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 1.69em"
                              ><span style="top: -3.69em"
                                ><span
                                  class="pstrut"
                                  style="height: 3.008em"
                                ></span
                                ><span class="mord"
                                  ><span class="mord mathnormal">p</span></span
                                ></span
                              ><span style="top: -2.25em"
                                ><span
                                  class="pstrut"
                                  style="height: 3.008em"
                                ></span
                                ><span class="mord"
                                  ><span class="mord">1</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.2222em"
                                  ></span
                                  ><span class="mbin">−</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.2222em"
                                  ></span
                                  ><span class="mord mathnormal">p</span></span
                                ></span
                              ></span
                            ><span class="vlist-s">​</span></span
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 1.19em"
                              ><span></span></span></span></span></span
                      ><span class="arraycolsep" style="width: 1em"></span
                      ><span class="col-align-l"
                        ><span class="vlist-t vlist-t2"
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 1.69em"
                              ><span style="top: -3.69em"
                                ><span
                                  class="pstrut"
                                  style="height: 3.008em"
                                ></span
                                ><span class="mord"
                                  ><span class="mord text"
                                    ><span class="mord">if&nbsp;</span></span
                                  ><span
                                    class="mord mathnormal"
                                    style="margin-right: 0.03588em"
                                    >y</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.2778em"
                                  ></span
                                  ><span class="mrel">=</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.2778em"
                                  ></span
                                  ><span class="mord">1</span></span
                                ></span
                              ><span style="top: -2.25em"
                                ><span
                                  class="pstrut"
                                  style="height: 3.008em"
                                ></span
                                ><span class="mord"
                                  ><span class="mord text"
                                    ><span class="mord">if&nbsp;</span></span
                                  ><span
                                    class="mord mathnormal"
                                    style="margin-right: 0.03588em"
                                    >y</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.2778em"
                                  ></span
                                  ><span class="mrel">=</span
                                  ><span
                                    class="mspace"
                                    style="margin-right: 0.2778em"
                                  ></span
                                  ><span class="mord">0</span></span
                                ></span
                              ></span
                            ><span class="vlist-s">​</span></span
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 1.19em"
                              ><span></span></span></span></span></span></span></span
                  ><span
                    class="mclose nulldelimiter"
                  ></span></span></span></span></span
        ></span>
      </p>
      <p>此时，交叉熵损失可以统一写成：</p>
      <p>
        <span class="katex-display"
          ><span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"
                ><semantics
                  ><mrow
                    ><mtext>CE</mtext><mo stretchy="false">(</mo
                    ><msub><mi>p</mi><mi>t</mi></msub
                    ><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><mi>log</mi
                    ><mo>⁡</mo><mo stretchy="false">(</mo
                    ><msub><mi>p</mi><mi>t</mi></msub
                    ><mo stretchy="false">)</mo></mrow
                  ><annotation encoding="application/x-tex"
                    >\text{CE}(p_t) = -\log(p_t)</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="mord text"><span class="mord">CE</span></span
                ><span class="mopen">(</span
                ><span class="mord"
                  ><span class="mord mathnormal">p</span
                  ><span class="msupsub"
                    ><span class="vlist-t vlist-t2"
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.2806em"
                          ><span
                            style="
                              top: -2.55em;
                              margin-left: 0em;
                              margin-right: 0.05em;
                            "
                            ><span class="pstrut" style="height: 2.7em"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mathnormal mtight"
                                >t</span
                              ></span
                            ></span
                          ></span
                        ><span class="vlist-s">​</span></span
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.15em"
                          ><span></span></span></span></span></span></span
                ><span class="mclose">)</span
                ><span class="mspace" style="margin-right: 0.2778em"></span
                ><span class="mrel">=</span
                ><span
                  class="mspace"
                  style="margin-right: 0.2778em"
                ></span></span
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="mord">−</span
                ><span class="mspace" style="margin-right: 0.1667em"></span
                ><span class="mop"
                  >lo<span style="margin-right: 0.01389em">g</span></span
                ><span class="mopen">(</span
                ><span class="mord"
                  ><span class="mord mathnormal">p</span
                  ><span class="msupsub"
                    ><span class="vlist-t vlist-t2"
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.2806em"
                          ><span
                            style="
                              top: -2.55em;
                              margin-left: 0em;
                              margin-right: 0.05em;
                            "
                            ><span class="pstrut" style="height: 2.7em"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mathnormal mtight"
                                >t</span
                              ></span
                            ></span
                          ></span
                        ><span class="vlist-s">​</span></span
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.15em"
                          ><span></span></span></span></span></span></span
                ><span class="mclose">)</span></span
              ></span
            ></span
          ></span
        >
      </p>
      <p>
        CE loss 有一个巨大的问题：对于 easy samples(<span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><msub><mi>p</mi><mi>t</mi></msub
                  ><mo>≫</mo><mi mathvariant="normal">.</mi><mn>5</mn></mrow
                ><annotation encoding="application/x-tex"
                  >p_t \gg .5</annotation
                ></semantics
              ></math
            ></span
          ><span class="katex-html" aria-hidden="true"
            ><span class="base"
              ><span
                class="strut"
                style="height: 0.7335em; vertical-align: -0.1944em"
              ></span
              ><span class="mord"
                ><span class="mord mathnormal">p</span
                ><span class="msupsub"
                  ><span class="vlist-t vlist-t2"
                    ><span class="vlist-r"
                      ><span class="vlist" style="height: 0.2806em"
                        ><span
                          style="
                            top: -2.55em;
                            margin-left: 0em;
                            margin-right: 0.05em;
                          "
                          ><span class="pstrut" style="height: 2.7em"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mathnormal mtight">t</span></span
                          ></span
                        ></span
                      ><span class="vlist-s">​</span></span
                    ><span class="vlist-r"
                      ><span class="vlist" style="height: 0.15em"
                        ><span></span></span></span></span></span></span
              ><span class="mspace" style="margin-right: 0.2778em"></span
              ><span class="mrel">≫</span
              ><span class="mspace" style="margin-right: 0.2778em"></span></span
            ><span class="base"
              ><span class="strut" style="height: 0.6444em"></span
              ><span class="mord">.5</span></span
            ></span
          ></span
        >)，它们仍然会产生很大的损失。easy sample
        太多时，小的损失值会被淹没。如图中蓝色的曲线所示。<br />
        <img src="../images/CE_and_FL_Loss.png" alt="CE_and_FL_Loss" />
      </p>
      <blockquote>
        <p>
          hard samples
          本身就难被预测，所以预测概率也会很小，损失就会被淹没。像下面这只猫，模型会对自己检测出来的结果毫无信心。
        </p>
      </blockquote>
      <figure>
        <img src="../images/unseen_cat.jpg" alt="unseen cat" />
        <figcaption style="color: gray">
          <small
            >猫猫：模型好不容易勉强把我检测出来，却没信心让我贡献损失……</small
          >
        </figcaption>
        <small> </small>
      </figure>
      <small>
        <h3 id="balanced-cross-entropy">Balanced Cross Entropy</h3>
        <p>
          引入加权因子<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>α</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >\alpha</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.4306em"></span
                ><span class="mord mathnormal" style="margin-right: 0.0037em"
                  >α</span
                ></span
              ></span
            ></span
          >，对少数类别赋予大权重<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>α</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >\alpha</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.4306em"></span
                ><span class="mord mathnormal" style="margin-right: 0.0037em"
                  >α</span
                ></span
              ></span
            ></span
          >，多数类别赋予小权重<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mn>1</mn><mo>−</mo><mi>α</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >1-\alpha</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.7278em; vertical-align: -0.0833em"
                ></span
                ><span class="mord">1</span
                ><span class="mspace" style="margin-right: 0.2222em"></span
                ><span class="mbin">−</span
                ><span
                  class="mspace"
                  style="margin-right: 0.2222em"
                ></span></span
              ><span class="base"
                ><span class="strut" style="height: 0.4306em"></span
                ><span class="mord mathnormal" style="margin-right: 0.0037em"
                  >α</span
                ></span
              ></span
            ></span
          >。改进后的公式可以表示如下：
        </p>
        <p>
          <span class="katex-display"
            ><span class="katex"
              ><span class="katex-mathml"
                ><math
                  xmlns="http://www.w3.org/1998/Math/MathML"
                  display="block"
                  ><semantics
                    ><mrow
                      ><mtext>CE</mtext><mo stretchy="false">(</mo
                      ><msub><mi>p</mi><mi>t</mi></msub
                      ><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo
                      ><msub><mi>α</mi><mi>t</mi></msub
                      ><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo
                      ><msub><mi>p</mi><mi>t</mi></msub
                      ><mo stretchy="false">)</mo></mrow
                    ><annotation encoding="application/x-tex"
                      >\text{CE}(p_t) = -\alpha_t \log(p_t)</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord text"><span class="mord">CE</span></span
                  ><span class="mopen">(</span
                  ><span class="mord"
                    ><span class="mord mathnormal">p</span
                    ><span class="msupsub"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.2806em"
                            ><span
                              style="
                                top: -2.55em;
                                margin-left: 0em;
                                margin-right: 0.05em;
                              "
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span class="mord mathnormal mtight"
                                  >t</span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.15em"
                            ><span></span></span></span></span></span></span
                  ><span class="mclose">)</span
                  ><span class="mspace" style="margin-right: 0.2778em"></span
                  ><span class="mrel">=</span
                  ><span
                    class="mspace"
                    style="margin-right: 0.2778em"
                  ></span></span
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord">−</span
                  ><span class="mord"
                    ><span
                      class="mord mathnormal"
                      style="margin-right: 0.0037em"
                      >α</span
                    ><span class="msupsub"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.2806em"
                            ><span
                              style="
                                top: -2.55em;
                                margin-left: -0.0037em;
                                margin-right: 0.05em;
                              "
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span class="mord mathnormal mtight"
                                  >t</span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.15em"
                            ><span></span></span></span></span></span></span
                  ><span class="mspace" style="margin-right: 0.1667em"></span
                  ><span class="mop"
                    >lo<span style="margin-right: 0.01389em">g</span></span
                  ><span class="mopen">(</span
                  ><span class="mord"
                    ><span class="mord mathnormal">p</span
                    ><span class="msupsub"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.2806em"
                            ><span
                              style="
                                top: -2.55em;
                                margin-left: 0em;
                                margin-right: 0.05em;
                              "
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span class="mord mathnormal mtight"
                                  >t</span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.15em"
                            ><span></span></span></span></span></span></span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            ></span
          >
        </p>
        <p>其中：</p>
        <ul>
          <li>
            <span class="katex"
              ><span class="katex-mathml"
                ><math xmlns="http://www.w3.org/1998/Math/MathML"
                  ><semantics
                    ><mrow
                      ><msub><mi>p</mi><mi>t</mi></msub></mrow
                    ><annotation encoding="application/x-tex"
                      >p_t</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 0.625em; vertical-align: -0.1944em"
                  ></span
                  ><span class="mord"
                    ><span class="mord mathnormal">p</span
                    ><span class="msupsub"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.2806em"
                            ><span
                              style="
                                top: -2.55em;
                                margin-left: 0em;
                                margin-right: 0.05em;
                              "
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span class="mord mathnormal mtight"
                                  >t</span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.15em"
                            ><span></span></span></span></span></span></span></span></span
            ></span>
            是模型对真实类别的预测概率。
          </li>
          <li>
            <span class="katex"
              ><span class="katex-mathml"
                ><math xmlns="http://www.w3.org/1998/Math/MathML"
                  ><semantics
                    ><mrow
                      ><msub><mi>α</mi><mi>t</mi></msub></mrow
                    ><annotation encoding="application/x-tex"
                      >\alpha_t</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 0.5806em; vertical-align: -0.15em"
                  ></span
                  ><span class="mord"
                    ><span
                      class="mord mathnormal"
                      style="margin-right: 0.0037em"
                      >α</span
                    ><span class="msupsub"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.2806em"
                            ><span
                              style="
                                top: -2.55em;
                                margin-left: -0.0037em;
                                margin-right: 0.05em;
                              "
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span class="mord mathnormal mtight"
                                  >t</span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.15em"
                            ><span></span></span></span></span></span></span></span></span
            ></span>
            是权重因子，定义如下：<br />
            <span class="katex-display"
              ><span class="katex"
                ><span class="katex-mathml"
                  ><math
                    xmlns="http://www.w3.org/1998/Math/MathML"
                    display="block"
                    ><semantics
                      ><mrow
                        ><msub><mi>α</mi><mi>t</mi></msub
                        ><mo>=</mo
                        ><mrow
                          ><mo fence="true">{</mo
                          ><mtable
                            rowspacing="0.36em"
                            columnalign="left left"
                            columnspacing="1em"
                            ><mtr
                              ><mtd
                                ><mstyle scriptlevel="0" displaystyle="false"
                                  ><mi>α</mi></mstyle
                                ></mtd
                              ><mtd
                                ><mstyle scriptlevel="0" displaystyle="false"
                                  ><mrow
                                    ><mtext>if&nbsp;</mtext><mi>y</mi><mo>=</mo
                                    ><mn>1</mn></mrow
                                  ></mstyle
                                ></mtd
                              ></mtr
                            ><mtr
                              ><mtd
                                ><mstyle scriptlevel="0" displaystyle="false"
                                  ><mrow
                                    ><mn>1</mn><mo>−</mo><mi>α</mi></mrow
                                  ></mstyle
                                ></mtd
                              ><mtd
                                ><mstyle scriptlevel="0" displaystyle="false"
                                  ><mrow
                                    ><mtext>if&nbsp;</mtext><mi>y</mi><mo>=</mo
                                    ><mn>0</mn></mrow
                                  ></mstyle
                                ></mtd
                              ></mtr
                            ></mtable
                          ></mrow
                        ></mrow
                      ><annotation encoding="application/x-tex"
                        >\alpha_t = \begin{cases} \alpha &amp; \text{if } y = 1
                        \\ 1 - \alpha &amp; \text{if } y = 0
                        \end{cases}</annotation
                      ></semantics
                    ></math
                  ></span
                ><span class="katex-html" aria-hidden="true"
                  ><span class="base"
                    ><span
                      class="strut"
                      style="height: 0.5806em; vertical-align: -0.15em"
                    ></span
                    ><span class="mord"
                      ><span
                        class="mord mathnormal"
                        style="margin-right: 0.0037em"
                        >α</span
                      ><span class="msupsub"
                        ><span class="vlist-t vlist-t2"
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 0.2806em"
                              ><span
                                style="
                                  top: -2.55em;
                                  margin-left: -0.0037em;
                                  margin-right: 0.05em;
                                "
                                ><span
                                  class="pstrut"
                                  style="height: 2.7em"
                                ></span
                                ><span class="sizing reset-size6 size3 mtight"
                                  ><span class="mord mathnormal mtight"
                                    >t</span
                                  ></span
                                ></span
                              ></span
                            ><span class="vlist-s">​</span></span
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 0.15em"
                              ><span></span></span></span></span></span></span
                    ><span class="mspace" style="margin-right: 0.2778em"></span
                    ><span class="mrel">=</span
                    ><span
                      class="mspace"
                      style="margin-right: 0.2778em"
                    ></span></span
                  ><span class="base"
                    ><span
                      class="strut"
                      style="height: 3em; vertical-align: -1.25em"
                    ></span
                    ><span class="minner"
                      ><span class="mopen delimcenter" style="top: 0em"
                        ><span class="delimsizing size4">{</span></span
                      ><span class="mord"
                        ><span class="mtable"
                          ><span class="col-align-l"
                            ><span class="vlist-t vlist-t2"
                              ><span class="vlist-r"
                                ><span class="vlist" style="height: 1.69em"
                                  ><span style="top: -3.69em"
                                    ><span
                                      class="pstrut"
                                      style="height: 3.008em"
                                    ></span
                                    ><span class="mord"
                                      ><span
                                        class="mord mathnormal"
                                        style="margin-right: 0.0037em"
                                        >α</span
                                      ></span
                                    ></span
                                  ><span style="top: -2.25em"
                                    ><span
                                      class="pstrut"
                                      style="height: 3.008em"
                                    ></span
                                    ><span class="mord"
                                      ><span class="mord">1</span
                                      ><span
                                        class="mspace"
                                        style="margin-right: 0.2222em"
                                      ></span
                                      ><span class="mbin">−</span
                                      ><span
                                        class="mspace"
                                        style="margin-right: 0.2222em"
                                      ></span
                                      ><span
                                        class="mord mathnormal"
                                        style="margin-right: 0.0037em"
                                        >α</span
                                      ></span
                                    ></span
                                  ></span
                                ><span class="vlist-s">​</span></span
                              ><span class="vlist-r"
                                ><span class="vlist" style="height: 1.19em"
                                  ><span></span></span></span></span></span
                          ><span class="arraycolsep" style="width: 1em"></span
                          ><span class="col-align-l"
                            ><span class="vlist-t vlist-t2"
                              ><span class="vlist-r"
                                ><span class="vlist" style="height: 1.69em"
                                  ><span style="top: -3.69em"
                                    ><span
                                      class="pstrut"
                                      style="height: 3.008em"
                                    ></span
                                    ><span class="mord"
                                      ><span class="mord text"
                                        ><span class="mord"
                                          >if&nbsp;</span
                                        ></span
                                      ><span
                                        class="mord mathnormal"
                                        style="margin-right: 0.03588em"
                                        >y</span
                                      ><span
                                        class="mspace"
                                        style="margin-right: 0.2778em"
                                      ></span
                                      ><span class="mrel">=</span
                                      ><span
                                        class="mspace"
                                        style="margin-right: 0.2778em"
                                      ></span
                                      ><span class="mord">1</span></span
                                    ></span
                                  ><span style="top: -2.25em"
                                    ><span
                                      class="pstrut"
                                      style="height: 3.008em"
                                    ></span
                                    ><span class="mord"
                                      ><span class="mord text"
                                        ><span class="mord"
                                          >if&nbsp;</span
                                        ></span
                                      ><span
                                        class="mord mathnormal"
                                        style="margin-right: 0.03588em"
                                        >y</span
                                      ><span
                                        class="mspace"
                                        style="margin-right: 0.2778em"
                                      ></span
                                      ><span class="mrel">=</span
                                      ><span
                                        class="mspace"
                                        style="margin-right: 0.2778em"
                                      ></span
                                      ><span class="mord">0</span></span
                                    ></span
                                  ></span
                                ><span class="vlist-s">​</span></span
                              ><span class="vlist-r"
                                ><span class="vlist" style="height: 1.19em"
                                  ><span></span></span></span></span></span></span></span
                      ><span
                        class="mclose nulldelimiter"
                      ></span></span></span></span></span
            ></span>
          </li>
        </ul>
        <h3 id="focal-loss-定义">Focal Loss 定义</h3>
        <p>
          虽然<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>α</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >\alpha</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.4306em"></span
                ><span class="mord mathnormal" style="margin-right: 0.0037em"
                  >α</span
                ></span
              ></span
            ></span
          >的引入平衡了正采样和负采样，但是还是没有拯救 hard samples
          被忽视的问题。<br />
          所以，我们要把训练集中在 hard samples 上。添加一个调节因子<span
            class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow
                    ><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo
                    ><msub><mi>p</mi><mi>t</mi></msub
                    ><msup><mo stretchy="false">)</mo><mi>γ</mi></msup></mrow
                  ><annotation encoding="application/x-tex"
                    >(1-p_t)^\gamma</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="mopen">(</span><span class="mord">1</span
                ><span class="mspace" style="margin-right: 0.2222em"></span
                ><span class="mbin">−</span
                ><span
                  class="mspace"
                  style="margin-right: 0.2222em"
                ></span></span
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 1em; vertical-align: -0.25em"
                ></span
                ><span class="mord"
                  ><span class="mord mathnormal">p</span
                  ><span class="msupsub"
                    ><span class="vlist-t vlist-t2"
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.2806em"
                          ><span
                            style="
                              top: -2.55em;
                              margin-left: 0em;
                              margin-right: 0.05em;
                            "
                            ><span class="pstrut" style="height: 2.7em"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mathnormal mtight"
                                >t</span
                              ></span
                            ></span
                          ></span
                        ><span class="vlist-s">​</span></span
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.15em"
                          ><span></span></span></span></span></span></span
                ><span class="mclose"
                  ><span class="mclose">)</span
                  ><span class="msupsub"
                    ><span class="vlist-t"
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.6644em"
                          ><span style="top: -3.063em; margin-right: 0.05em"
                            ><span class="pstrut" style="height: 2.7em"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span
                                class="mord mathnormal mtight"
                                style="margin-right: 0.05556em"
                                >γ</span
                              ></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          >，其中<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>γ</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >\gamma</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.625em; vertical-align: -0.1944em"
                ></span
                ><span class="mord mathnormal" style="margin-right: 0.05556em"
                  >γ</span
                ></span
              ></span
            ></span
          >是超参数。focal loss 公式如下：
        </p>
        <p>
          <span class="katex-display"
            ><span class="katex"
              ><span class="katex-mathml"
                ><math
                  xmlns="http://www.w3.org/1998/Math/MathML"
                  display="block"
                  ><semantics
                    ><mrow
                      ><mtext>FL</mtext><mo stretchy="false">(</mo
                      ><msub><mi>p</mi><mi>t</mi></msub
                      ><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo
                      ><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo
                      ><msub><mi>p</mi><mi>t</mi></msub
                      ><msup><mo stretchy="false">)</mo><mi>γ</mi></msup
                      ><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo
                      ><msub><mi>p</mi><mi>t</mi></msub
                      ><mo stretchy="false">)</mo></mrow
                    ><annotation encoding="application/x-tex"
                      >\text{FL}(p_t) = -(1 - p_t)^\gamma \log(p_t)</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord text"><span class="mord">FL</span></span
                  ><span class="mopen">(</span
                  ><span class="mord"
                    ><span class="mord mathnormal">p</span
                    ><span class="msupsub"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.2806em"
                            ><span
                              style="
                                top: -2.55em;
                                margin-left: 0em;
                                margin-right: 0.05em;
                              "
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span class="mord mathnormal mtight"
                                  >t</span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.15em"
                            ><span></span></span></span></span></span></span
                  ><span class="mclose">)</span
                  ><span class="mspace" style="margin-right: 0.2778em"></span
                  ><span class="mrel">=</span
                  ><span
                    class="mspace"
                    style="margin-right: 0.2778em"
                  ></span></span
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord">−</span><span class="mopen">(</span
                  ><span class="mord">1</span
                  ><span class="mspace" style="margin-right: 0.2222em"></span
                  ><span class="mbin">−</span
                  ><span
                    class="mspace"
                    style="margin-right: 0.2222em"
                  ></span></span
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord"
                    ><span class="mord mathnormal">p</span
                    ><span class="msupsub"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.2806em"
                            ><span
                              style="
                                top: -2.55em;
                                margin-left: 0em;
                                margin-right: 0.05em;
                              "
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span class="mord mathnormal mtight"
                                  >t</span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.15em"
                            ><span></span></span></span></span></span></span
                  ><span class="mclose"
                    ><span class="mclose">)</span
                    ><span class="msupsub"
                      ><span class="vlist-t"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.7144em"
                            ><span style="top: -3.113em; margin-right: 0.05em"
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span
                                  class="mord mathnormal mtight"
                                  style="margin-right: 0.05556em"
                                  >γ</span
                                ></span
                              ></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ><span class="mspace" style="margin-right: 0.1667em"></span
                  ><span class="mop"
                    >lo<span style="margin-right: 0.01389em">g</span></span
                  ><span class="mopen">(</span
                  ><span class="mord"
                    ><span class="mord mathnormal">p</span
                    ><span class="msupsub"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.2806em"
                            ><span
                              style="
                                top: -2.55em;
                                margin-left: 0em;
                                margin-right: 0.05em;
                              "
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span class="mord mathnormal mtight"
                                  >t</span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.15em"
                            ><span></span></span></span></span></span></span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            ></span
          >
        </p>
        <p>
          <img src="../images/CE_and_FL_Loss.png" alt="CE_and_FL_Loss" /><br />
          再次观察图片。
        </p>
        <ul>
          <li>
            <p><strong>当样本分类错误时</strong>：</p>
            <ul>
              <li>
                此时模型对真实类别的预测概率
                <span class="katex"
                  ><span class="katex-mathml"
                    ><math xmlns="http://www.w3.org/1998/Math/MathML"
                      ><semantics
                        ><mrow
                          ><msub><mi>p</mi><mi>t</mi></msub></mrow
                        ><annotation encoding="application/x-tex"
                          >p_t</annotation
                        ></semantics
                      ></math
                    ></span
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 0.625em; vertical-align: -0.1944em"
                      ></span
                      ><span class="mord"
                        ><span class="mord mathnormal">p</span
                        ><span class="msupsub"
                          ><span class="vlist-t vlist-t2"
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.2806em"
                                ><span
                                  style="
                                    top: -2.55em;
                                    margin-left: 0em;
                                    margin-right: 0.05em;
                                  "
                                  ><span
                                    class="pstrut"
                                    style="height: 2.7em"
                                  ></span
                                  ><span class="sizing reset-size6 size3 mtight"
                                    ><span class="mord mathnormal mtight"
                                      >t</span
                                    ></span
                                  ></span
                                ></span
                              ><span class="vlist-s">​</span></span
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.15em"
                                ><span></span></span></span></span></span></span></span></span
                ></span>
                较低（例如
                <span class="katex"
                  ><span class="katex-mathml"
                    ><math xmlns="http://www.w3.org/1998/Math/MathML"
                      ><semantics
                        ><mrow
                          ><msub><mi>p</mi><mi>t</mi></msub
                          ><mo>=</mo><mn>0.1</mn></mrow
                        ><annotation encoding="application/x-tex"
                          >p_t = 0.1</annotation
                        ></semantics
                      ></math
                    ></span
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 0.625em; vertical-align: -0.1944em"
                      ></span
                      ><span class="mord"
                        ><span class="mord mathnormal">p</span
                        ><span class="msupsub"
                          ><span class="vlist-t vlist-t2"
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.2806em"
                                ><span
                                  style="
                                    top: -2.55em;
                                    margin-left: 0em;
                                    margin-right: 0.05em;
                                  "
                                  ><span
                                    class="pstrut"
                                    style="height: 2.7em"
                                  ></span
                                  ><span class="sizing reset-size6 size3 mtight"
                                    ><span class="mord mathnormal mtight"
                                      >t</span
                                    ></span
                                  ></span
                                ></span
                              ><span class="vlist-s">​</span></span
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.15em"
                                ><span></span></span></span></span></span></span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2778em"
                      ></span
                      ><span class="mrel">=</span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2778em"
                      ></span></span
                    ><span class="base"
                      ><span class="strut" style="height: 0.6444em"></span
                      ><span class="mord">0.1</span></span
                    ></span
                  ></span
                >）。
              </li>
              <li>
                调制因子
                <span class="katex"
                  ><span class="katex-mathml"
                    ><math xmlns="http://www.w3.org/1998/Math/MathML"
                      ><semantics
                        ><mrow
                          ><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo
                          ><msub><mi>p</mi><mi>t</mi></msub
                          ><msup
                            ><mo stretchy="false">)</mo><mi>γ</mi></msup
                          ></mrow
                        ><annotation encoding="application/x-tex"
                          >(1 - p_t)^\gamma</annotation
                        ></semantics
                      ></math
                    ></span
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 1em; vertical-align: -0.25em"
                      ></span
                      ><span class="mopen">(</span><span class="mord">1</span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2222em"
                      ></span
                      ><span class="mbin">−</span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2222em"
                      ></span></span
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 1em; vertical-align: -0.25em"
                      ></span
                      ><span class="mord"
                        ><span class="mord mathnormal">p</span
                        ><span class="msupsub"
                          ><span class="vlist-t vlist-t2"
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.2806em"
                                ><span
                                  style="
                                    top: -2.55em;
                                    margin-left: 0em;
                                    margin-right: 0.05em;
                                  "
                                  ><span
                                    class="pstrut"
                                    style="height: 2.7em"
                                  ></span
                                  ><span class="sizing reset-size6 size3 mtight"
                                    ><span class="mord mathnormal mtight"
                                      >t</span
                                    ></span
                                  ></span
                                ></span
                              ><span class="vlist-s">​</span></span
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.15em"
                                ><span></span></span></span></span></span></span
                      ><span class="mclose"
                        ><span class="mclose">)</span
                        ><span class="msupsub"
                          ><span class="vlist-t"
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.6644em"
                                ><span
                                  style="top: -3.063em; margin-right: 0.05em"
                                  ><span
                                    class="pstrut"
                                    style="height: 2.7em"
                                  ></span
                                  ><span class="sizing reset-size6 size3 mtight"
                                    ><span
                                      class="mord mathnormal mtight"
                                      style="margin-right: 0.05556em"
                                      >γ</span
                                    ></span
                                  ></span
                                ></span
                              ></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                >
                接近 1，因此 Focal Loss 几乎不受影响，与交叉熵损失（CE
                Loss）接近。
              </li>
            </ul>
          </li>
          <li>
            <p><strong>当样本分类正确时</strong>：</p>
            <ul>
              <li>
                模型对真实类别的预测概率
                <span class="katex"
                  ><span class="katex-mathml"
                    ><math xmlns="http://www.w3.org/1998/Math/MathML"
                      ><semantics
                        ><mrow
                          ><msub><mi>p</mi><mi>t</mi></msub></mrow
                        ><annotation encoding="application/x-tex"
                          >p_t</annotation
                        ></semantics
                      ></math
                    ></span
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 0.625em; vertical-align: -0.1944em"
                      ></span
                      ><span class="mord"
                        ><span class="mord mathnormal">p</span
                        ><span class="msupsub"
                          ><span class="vlist-t vlist-t2"
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.2806em"
                                ><span
                                  style="
                                    top: -2.55em;
                                    margin-left: 0em;
                                    margin-right: 0.05em;
                                  "
                                  ><span
                                    class="pstrut"
                                    style="height: 2.7em"
                                  ></span
                                  ><span class="sizing reset-size6 size3 mtight"
                                    ><span class="mord mathnormal mtight"
                                      >t</span
                                    ></span
                                  ></span
                                ></span
                              ><span class="vlist-s">​</span></span
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.15em"
                                ><span></span></span></span></span></span></span></span></span
                ></span>
                较高（例如
                <span class="katex"
                  ><span class="katex-mathml"
                    ><math xmlns="http://www.w3.org/1998/Math/MathML"
                      ><semantics
                        ><mrow
                          ><msub><mi>p</mi><mi>t</mi></msub
                          ><mo>=</mo><mn>0.9</mn></mrow
                        ><annotation encoding="application/x-tex"
                          >p_t = 0.9</annotation
                        ></semantics
                      ></math
                    ></span
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 0.625em; vertical-align: -0.1944em"
                      ></span
                      ><span class="mord"
                        ><span class="mord mathnormal">p</span
                        ><span class="msupsub"
                          ><span class="vlist-t vlist-t2"
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.2806em"
                                ><span
                                  style="
                                    top: -2.55em;
                                    margin-left: 0em;
                                    margin-right: 0.05em;
                                  "
                                  ><span
                                    class="pstrut"
                                    style="height: 2.7em"
                                  ></span
                                  ><span class="sizing reset-size6 size3 mtight"
                                    ><span class="mord mathnormal mtight"
                                      >t</span
                                    ></span
                                  ></span
                                ></span
                              ><span class="vlist-s">​</span></span
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.15em"
                                ><span></span></span></span></span></span></span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2778em"
                      ></span
                      ><span class="mrel">=</span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2778em"
                      ></span></span
                    ><span class="base"
                      ><span class="strut" style="height: 0.6444em"></span
                      ><span class="mord">0.9</span></span
                    ></span
                  ></span
                >）。
              </li>
              <li>
                调制因子
                <span class="katex"
                  ><span class="katex-mathml"
                    ><math xmlns="http://www.w3.org/1998/Math/MathML"
                      ><semantics
                        ><mrow
                          ><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo
                          ><msub><mi>p</mi><mi>t</mi></msub
                          ><msup
                            ><mo stretchy="false">)</mo><mi>γ</mi></msup
                          ></mrow
                        ><annotation encoding="application/x-tex"
                          >(1 - p_t)^\gamma</annotation
                        ></semantics
                      ></math
                    ></span
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 1em; vertical-align: -0.25em"
                      ></span
                      ><span class="mopen">(</span><span class="mord">1</span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2222em"
                      ></span
                      ><span class="mbin">−</span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2222em"
                      ></span></span
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 1em; vertical-align: -0.25em"
                      ></span
                      ><span class="mord"
                        ><span class="mord mathnormal">p</span
                        ><span class="msupsub"
                          ><span class="vlist-t vlist-t2"
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.2806em"
                                ><span
                                  style="
                                    top: -2.55em;
                                    margin-left: 0em;
                                    margin-right: 0.05em;
                                  "
                                  ><span
                                    class="pstrut"
                                    style="height: 2.7em"
                                  ></span
                                  ><span class="sizing reset-size6 size3 mtight"
                                    ><span class="mord mathnormal mtight"
                                      >t</span
                                    ></span
                                  ></span
                                ></span
                              ><span class="vlist-s">​</span></span
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.15em"
                                ><span></span></span></span></span></span></span
                      ><span class="mclose"
                        ><span class="mclose">)</span
                        ><span class="msupsub"
                          ><span class="vlist-t"
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.6644em"
                                ><span
                                  style="top: -3.063em; margin-right: 0.05em"
                                  ><span
                                    class="pstrut"
                                    style="height: 2.7em"
                                  ></span
                                  ><span class="sizing reset-size6 size3 mtight"
                                    ><span
                                      class="mord mathnormal mtight"
                                      style="margin-right: 0.05556em"
                                      >γ</span
                                    ></span
                                  ></span
                                ></span
                              ></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                >
                接近 0，因此 Focal Loss 被大幅降低。
              </li>
              <li>
                例如：如果
                <span class="katex"
                  ><span class="katex-mathml"
                    ><math xmlns="http://www.w3.org/1998/Math/MathML"
                      ><semantics
                        ><mrow
                          ><msub><mi>p</mi><mi>t</mi></msub
                          ><mo>=</mo><mn>0.9</mn></mrow
                        ><annotation encoding="application/x-tex"
                          >p_t = 0.9</annotation
                        ></semantics
                      ></math
                    ></span
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 0.625em; vertical-align: -0.1944em"
                      ></span
                      ><span class="mord"
                        ><span class="mord mathnormal">p</span
                        ><span class="msupsub"
                          ><span class="vlist-t vlist-t2"
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.2806em"
                                ><span
                                  style="
                                    top: -2.55em;
                                    margin-left: 0em;
                                    margin-right: 0.05em;
                                  "
                                  ><span
                                    class="pstrut"
                                    style="height: 2.7em"
                                  ></span
                                  ><span class="sizing reset-size6 size3 mtight"
                                    ><span class="mord mathnormal mtight"
                                      >t</span
                                    ></span
                                  ></span
                                ></span
                              ><span class="vlist-s">​</span></span
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.15em"
                                ><span></span></span></span></span></span></span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2778em"
                      ></span
                      ><span class="mrel">=</span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2778em"
                      ></span></span
                    ><span class="base"
                      ><span class="strut" style="height: 0.6444em"></span
                      ><span class="mord">0.9</span></span
                    ></span
                  ></span
                >，<span class="katex"
                  ><span class="katex-mathml"
                    ><math xmlns="http://www.w3.org/1998/Math/MathML"
                      ><semantics
                        ><mrow><mi>γ</mi><mo>=</mo><mn>2</mn></mrow
                        ><annotation encoding="application/x-tex"
                          >\gamma = 2</annotation
                        ></semantics
                      ></math
                    ></span
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 0.625em; vertical-align: -0.1944em"
                      ></span
                      ><span
                        class="mord mathnormal"
                        style="margin-right: 0.05556em"
                        >γ</span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2778em"
                      ></span
                      ><span class="mrel">=</span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2778em"
                      ></span></span
                    ><span class="base"
                      ><span class="strut" style="height: 0.6444em"></span
                      ><span class="mord">2</span></span
                    ></span
                  ></span
                >，则
                <span class="katex"
                  ><span class="katex-mathml"
                    ><math xmlns="http://www.w3.org/1998/Math/MathML"
                      ><semantics
                        ><mrow
                          ><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo
                          ><mn>0.9</mn
                          ><msup><mo stretchy="false">)</mo><mn>2</mn></msup
                          ><mo>=</mo><mn>0.01</mn></mrow
                        ><annotation encoding="application/x-tex"
                          >(1 - 0.9)^2 = 0.01</annotation
                        ></semantics
                      ></math
                    ></span
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 1em; vertical-align: -0.25em"
                      ></span
                      ><span class="mopen">(</span><span class="mord">1</span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2222em"
                      ></span
                      ><span class="mbin">−</span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2222em"
                      ></span></span
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 1.0641em; vertical-align: -0.25em"
                      ></span
                      ><span class="mord">0.9</span
                      ><span class="mclose"
                        ><span class="mclose">)</span
                        ><span class="msupsub"
                          ><span class="vlist-t"
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.8141em"
                                ><span
                                  style="top: -3.063em; margin-right: 0.05em"
                                  ><span
                                    class="pstrut"
                                    style="height: 2.7em"
                                  ></span
                                  ><span class="sizing reset-size6 size3 mtight"
                                    ><span class="mord mtight">2</span></span
                                  ></span
                                ></span
                              ></span
                            ></span
                          ></span
                        ></span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2778em"
                      ></span
                      ><span class="mrel">=</span
                      ><span
                        class="mspace"
                        style="margin-right: 0.2778em"
                      ></span></span
                    ><span class="base"
                      ><span class="strut" style="height: 0.6444em"></span
                      ><span class="mord">0.01</span></span
                    ></span
                  ></span
                >，损失缩小了 100 倍。
              </li>
            </ul>
          </li>
        </ul>
        <p>
          很明显，<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>γ</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >\gamma</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.625em; vertical-align: -0.1944em"
                ></span
                ><span class="mord mathnormal" style="margin-right: 0.05556em"
                  >γ</span
                ></span
              ></span
            ></span
          >越大，对 easy samples 的抑制作用越大，模型越聚焦于难分类样本。<br />
          实践中，我们可以保留上述的<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>α</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >\alpha</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.4306em"></span
                ><span class="mord mathnormal" style="margin-right: 0.0037em"
                  >α</span
                ></span
              ></span
            ></span
          >，可以提高精度。
        </p>
        <p>
          <span class="katex-display"
            ><span class="katex"
              ><span class="katex-mathml"
                ><math
                  xmlns="http://www.w3.org/1998/Math/MathML"
                  display="block"
                  ><semantics
                    ><mrow
                      ><mtext>FL</mtext><mo stretchy="false">(</mo
                      ><msub><mi>p</mi><mi>t</mi></msub
                      ><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo
                      ><msub><mi>α</mi><mi>t</mi></msub
                      ><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo
                      ><msub><mi>p</mi><mi>t</mi></msub
                      ><msup><mo stretchy="false">)</mo><mi>γ</mi></msup
                      ><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo
                      ><msub><mi>p</mi><mi>t</mi></msub
                      ><mo stretchy="false">)</mo></mrow
                    ><annotation encoding="application/x-tex"
                      >\text{FL}(p_t) = -\alpha_t(1 - p_t)^\gamma
                      \log(p_t)</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord text"><span class="mord">FL</span></span
                  ><span class="mopen">(</span
                  ><span class="mord"
                    ><span class="mord mathnormal">p</span
                    ><span class="msupsub"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.2806em"
                            ><span
                              style="
                                top: -2.55em;
                                margin-left: 0em;
                                margin-right: 0.05em;
                              "
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span class="mord mathnormal mtight"
                                  >t</span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.15em"
                            ><span></span></span></span></span></span></span
                  ><span class="mclose">)</span
                  ><span class="mspace" style="margin-right: 0.2778em"></span
                  ><span class="mrel">=</span
                  ><span
                    class="mspace"
                    style="margin-right: 0.2778em"
                  ></span></span
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord">−</span
                  ><span class="mord"
                    ><span
                      class="mord mathnormal"
                      style="margin-right: 0.0037em"
                      >α</span
                    ><span class="msupsub"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.2806em"
                            ><span
                              style="
                                top: -2.55em;
                                margin-left: -0.0037em;
                                margin-right: 0.05em;
                              "
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span class="mord mathnormal mtight"
                                  >t</span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.15em"
                            ><span></span></span></span></span></span></span
                  ><span class="mopen">(</span><span class="mord">1</span
                  ><span class="mspace" style="margin-right: 0.2222em"></span
                  ><span class="mbin">−</span
                  ><span
                    class="mspace"
                    style="margin-right: 0.2222em"
                  ></span></span
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord"
                    ><span class="mord mathnormal">p</span
                    ><span class="msupsub"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.2806em"
                            ><span
                              style="
                                top: -2.55em;
                                margin-left: 0em;
                                margin-right: 0.05em;
                              "
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span class="mord mathnormal mtight"
                                  >t</span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.15em"
                            ><span></span></span></span></span></span></span
                  ><span class="mclose"
                    ><span class="mclose">)</span
                    ><span class="msupsub"
                      ><span class="vlist-t"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.7144em"
                            ><span style="top: -3.113em; margin-right: 0.05em"
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span
                                  class="mord mathnormal mtight"
                                  style="margin-right: 0.05556em"
                                  >γ</span
                                ></span
                              ></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ><span class="mspace" style="margin-right: 0.1667em"></span
                  ><span class="mop"
                    >lo<span style="margin-right: 0.01389em">g</span></span
                  ><span class="mopen">(</span
                  ><span class="mord"
                    ><span class="mord mathnormal">p</span
                    ><span class="msupsub"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.2806em"
                            ><span
                              style="
                                top: -2.55em;
                                margin-left: 0em;
                                margin-right: 0.05em;
                              "
                              ><span class="pstrut" style="height: 2.7em"></span
                              ><span class="sizing reset-size6 size3 mtight"
                                ><span class="mord mathnormal mtight"
                                  >t</span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist" style="height: 0.15em"
                            ><span></span></span></span></span></span></span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            ></span
          >
        </p>
        <h3 id="类别失衡与模型初始化">类别失衡与模型初始化</h3>
        <p>
          二分类模型的默认初始化认为输出<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>y</mi><mo>=</mo><mo>+</mo><mn>1</mn></mrow
                  ><annotation encoding="application/x-tex"
                    >y=+1</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.625em; vertical-align: -0.1944em"
                ></span
                ><span class="mord mathnormal" style="margin-right: 0.03588em"
                  >y</span
                ><span class="mspace" style="margin-right: 0.2778em"></span
                ><span class="mrel">=</span
                ><span
                  class="mspace"
                  style="margin-right: 0.2778em"
                ></span></span
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.7278em; vertical-align: -0.0833em"
                ></span
                ><span class="mord">+</span><span class="mord">1</span></span
              ></span
            ></span
          >和<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>y</mi><mo>=</mo><mo>−</mo><mn>1</mn></mrow
                  ><annotation encoding="application/x-tex"
                    >y=-1</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.625em; vertical-align: -0.1944em"
                ></span
                ><span class="mord mathnormal" style="margin-right: 0.03588em"
                  >y</span
                ><span class="mspace" style="margin-right: 0.2778em"></span
                ><span class="mrel">=</span
                ><span
                  class="mspace"
                  style="margin-right: 0.2778em"
                ></span></span
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.7278em; vertical-align: -0.0833em"
                ></span
                ><span class="mord">−</span><span class="mord">1</span></span
              ></span
            ></span
          >的概率是相等的。然而在我们类别失衡的前提下，这种初始化是不行的，会导致频繁出现的类别（频繁类）主导总损失，把出现少的类别（稀有类）的生态位占领了。
        </p>
        <blockquote>
          <p>
            Sigmoid 函数接受输入为 0 时输出接近
            0.5。训练初期，随机初始化的模型参数对所有样本的输出都接近
            0，于是预测概率都接近
            0.5。由于频繁类的频繁出现，在个体损失均等的前提下，频繁类的损失会远远高于稀有类。
          </p>
        </blockquote>
        <p>
          我们引入一个“先验概率”<span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>π</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >\pi</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.4306em"></span
                ><span class="mord mathnormal" style="margin-right: 0.03588em"
                  >π</span
                ></span
              ></span
            ></span
          >来让稀有类的地位提高，使得模型对稀有类（正类）的预测概率接近一个小值
          <span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>π</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >\pi</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.4306em"></span
                ><span class="mord mathnormal" style="margin-right: 0.03588em"
                  >π</span
                ></span
              ></span
            ></span
          >
          （例如修改模型输出前的偏置 b）。
        </p>
        <blockquote>
          <p>
            我们可以假设没有偏置时输出为 0，那么模型输出层的输出就是 b。代入
            Sigmoid 的公式，再令它与<span class="katex"
              ><span class="katex-mathml"
                ><math xmlns="http://www.w3.org/1998/Math/MathML"
                  ><semantics
                    ><mrow><mi>π</mi></mrow
                    ><annotation encoding="application/x-tex"
                      >\pi</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span class="strut" style="height: 0.4306em"></span
                  ><span class="mord mathnormal" style="margin-right: 0.03588em"
                    >π</span
                  ></span
                ></span
              ></span
            >相等，解得 b。
          </p>
        </blockquote>
        <p>
          <strong>这里仅仅是对模型的初始化产生了调整</strong
          >，提升了训练稳定性。
        </p>
        <h3 id="类别失衡与两阶段检测器">类别失衡与两阶段检测器</h3>
        <p>两阶段检测器解决类别失衡的方法的方法：</p>
        <ol>
          <li>
            RPN 等方式选择 Proposal 并且运用 NMS 筛选，降低了候选框数量到
            1-2k，并且消除了大量的 easy negative（背景区域）。
          </li>
          <li>对于每个 mini-batch 采样，强制保持正负样本比例固定。</li>
        </ol>
        <h2 id="retinanet">RetinaNet</h2>
        <p>
          RetinaNet 的网络构造和前面几篇论文的构建思路没有区别。网络图如下：<br />
          <img src="../images/RetinaNet.png" alt="RetinaNet" />
        </p>
        <p>
          锚框的设置和 FPN 下的 RPN
          很像。但是论文对每种额外增设了三种不同的纵横比的锚框
          <span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow
                    ><msup><mn>2</mn><mn>0</mn></msup
                    ><mo separator="true">,</mo
                    ><msup
                      ><mn>2</mn
                      ><mrow
                        ><mn>1</mn><mi mathvariant="normal">/</mi
                        ><mn>3</mn></mrow
                      ></msup
                    ><mo separator="true">,</mo
                    ><msup
                      ><mn>2</mn
                      ><mrow
                        ><mn>2</mn><mi mathvariant="normal">/</mi
                        ><mn>3</mn></mrow
                      ></msup
                    ></mrow
                  ><annotation encoding="application/x-tex"
                    >2^0, 2^{1/3}, 2^{2/3}</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 1.0824em; vertical-align: -0.1944em"
                ></span
                ><span class="mord"
                  ><span class="mord">2</span
                  ><span class="msupsub"
                    ><span class="vlist-t"
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.8141em"
                          ><span style="top: -3.063em; margin-right: 0.05em"
                            ><span class="pstrut" style="height: 2.7em"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mtight">0</span></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ><span class="mpunct">,</span
                ><span class="mspace" style="margin-right: 0.1667em"></span
                ><span class="mord"
                  ><span class="mord">2</span
                  ><span class="msupsub"
                    ><span class="vlist-t"
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.888em"
                          ><span style="top: -3.063em; margin-right: 0.05em"
                            ><span class="pstrut" style="height: 2.7em"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mtight"
                                ><span class="mord mtight">1/3</span></span
                              ></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ><span class="mpunct">,</span
                ><span class="mspace" style="margin-right: 0.1667em"></span
                ><span class="mord"
                  ><span class="mord">2</span
                  ><span class="msupsub"
                    ><span class="vlist-t"
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.888em"
                          ><span style="top: -3.063em; margin-right: 0.05em"
                            ><span class="pstrut" style="height: 2.7em"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mtight"
                                ><span class="mord mtight">2/3</span></span
                              ></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          >。这样训练出来的精度更高。
        </p>
      </small>
    </div>
  </body>
</html>
